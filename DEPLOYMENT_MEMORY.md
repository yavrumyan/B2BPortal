# B2B Portal ‚Äì Hostinger Deployment Session Memory
_Last updated: 2026-02-28 ‚Äî **DEPLOYMENT SUCCESSFUL ‚úÖ**_

---

## Server Details
| Item | Value |
|---|---|
| Domain | https://b2b.chip.am |
| SSH | `ssh -p 65002 u217740454@178.16.128.65` |
| App root | `/home/u217740454/domains/b2b.chip.am/public_html` |
| Node binary | `/opt/alt/alt-nodejs20/root/bin/node` |
| Node version | v20.19.4 |
| Web server | LiteSpeed with Phusion Passenger (`lsnode.js`) |

---

## How Hostinger Auto-Deployment Works

- GitHub push ‚Üí Hostinger pulls code ‚Üí runs `npm install && npm run build` ‚Üí deploys to `public_html`
- Auto-deployment **wipes** `public_html/.env` on each deployment (not in GitHub = deleted)
- Hostinger **regenerates** `.htaccess` from hPanel Node.js settings on each deployment
- hPanel Node.js startup file is now set to `app.cjs` ‚úÖ ‚Äî `.htaccess` auto-generates correctly after each deploy
- No manual SSH patching needed after deploys anymore

---

## Current State of Key Files

### `.htaccess` (controls Passenger ‚Äî regenerated by hPanel on each deploy)
After manual fix, should contain:
```
PassengerAppRoot /home/u217740454/domains/b2b.chip.am/public_html
PassengerAppType node
PassengerNodejs /opt/alt/alt-nodejs20/root/bin/node
PassengerStartupFile app.cjs
PassengerBaseURI /
```

### `app.cjs` (correct startup file ‚Äî CJS wrapper, in GitHub)
- Lives in `nodejs/` (NOT `public_html/` ‚Äî `public_html/` only holds `.htaccess` and empty `tmp/`)
- Reads `~/.b2b_env` (home dir, persists across deploys) then `nodejs/.env` (local fallback)
- Uses dynamic `import()` to load `dist/index.js` in the SAME process
- `.cjs` extension = always CJS, lsnode.js can `require()` it reliably

### `~/.b2b_env` (credentials ‚Äî home dir, NEVER wiped by auto-deploys)
```
DATABASE_URL=postgresql://neondb_owner:npg_uc3ONdnwSP7f@ep-withered-mud-agtqm7md-pooler.c-2.eu-central-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require
SESSION_SECRET=06e3fe296c2ba643eca33c73cdcce622f83b60c32621320b632b79cb84f83e09
NODE_ENV=production
APP_URL=https://b2b.chip.am
GMAIL_USER=b2b.chip.am@gmail.com
GMAIL_APP_PASSWORD=rrdecgrvaycygake
```
‚ö†Ô∏è `GMAIL_APP_PASSWORD` is a **Gmail App Password** (16 chars, no spaces), NOT the regular account password.
To regenerate: myaccount.google.com/apppasswords ‚Üí Mail ‚Üí Other ‚Üí "B2B Portal" ‚Üí Generate.

If lost, recreate:
```bash
cat > ~/.b2b_env << 'EOF'
DATABASE_URL=postgresql://neondb_owner:npg_uc3ONdnwSP7f@ep-withered-mud-agtqm7md-pooler.c-2.eu-central-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require
SESSION_SECRET=06e3fe296c2ba643eca33c73cdcce622f83b60c32621320b632b79cb84f83e09
NODE_ENV=production
APP_URL=https://b2b.chip.am
GMAIL_USER=b2b.chip.am@gmail.com
GMAIL_APP_PASSWORD=rrdecgrvaycygake
EOF
chmod 600 ~/.b2b_env
```

### `logger.js` (in GitHub ‚Äî rewritten but problematic with Passenger)
- ESM module (because `"type":"module"` in package.json)
- lsnode.js uses `require()` which cannot load ESM ‚Üí 503
- Use `app.cjs` instead

---

## Why `app.cjs` Works and `logger.js` Doesn't (with Passenger)

- `package.json` has `"type": "module"` ‚Üí all `.js` files are ESM
- lsnode.js uses `require()` to load startup file
- `.cjs` extension = always CJS ‚Üí lsnode.js `require()`s it fine
- `.js` extension with `"type":"module"` = ESM ‚Üí lsnode.js `require()` fails ‚Üí 503
- `app.cjs` uses `import()` in same process ‚Üí lsnode.js intercepts `http.listen()` ‚úÖ

---

## Database
- Provider: **Neon PostgreSQL** (free tier)
- Connection: `ep-withered-mud-agtqm7md-pooler.c-2.eu-central-1.aws.neon.tech`
- Tables: Auto-created on first startup
- Admin account: `admin@b2b.chip.am` / `admin789` (**change after first login**)
- ‚ö†Ô∏è **TODO**: Run `DROP TABLE IF EXISTS "session";` in Neon SQL Editor (orphaned `session_pkey` index)

---

## What Was Fixed in This Session (2026-02-21)

1. **`session_pkey already exists`** crash ‚Üí removed manual session table from `startup.ts`
2. **Assets not found** (logo/sound) ‚Üí moved to `client/src/assets/`, updated vite alias
3. **`googleapis` crash** ‚Üí replaced `email.ts` with Nodemailer/Gmail SMTP
4. **`DATABASE_URL must be set`** after deploy ‚Üí created `~/.b2b_env` in home dir
5. **503 after auto-deploy** ‚Üí `.htaccess` reverts to `logger.js`; patched hPanel to use `app.cjs` ‚úÖ (permanent fix done)

## What Was Fixed in This Session (2026-02-22)

1. **Admin Clients section empty** ‚Äî root cause: `adminSeen: boolean()` in `schema.ts` told Drizzle to
   query column as `"adminSeen"` (camelCase), but DB column was `admin_seen` (snake_case from manual SQL).
   Caused 500 on every `orders` query ‚Üí `/api/customers` silently returned empty.
   **Fix**: `shared/schema.ts` ‚Üí `adminSeen: boolean("admin_seen")` (also added `seen: boolean("seen")` for explicitness).

2. **Pending users auto-approved** ‚Äî `updateCustomerStatusByDebt()` in `storage.ts` had default
   `newStatus = "approved"`, so every pending user with no orders was silently approved when admin
   viewed the Clients list.
   **Fix**: `server/storage.ts` ‚Üí skip recalculation for `pending`/`rejected`/`admin` accounts entirely.

3. **Pending/rejected users could log in** ‚Äî login endpoint had no status check.
   **Fix**: `server/routes.ts` ‚Üí POST `/api/auth/login` returns 403 for `pending` and `rejected` accounts.

4. **Non-approved users could place orders** ‚Äî order endpoint had no status check.
   **Fix**: `server/routes.ts` ‚Üí POST `/api/orders` returns 403 for `pending`, `rejected`, `paused` accounts.

## What Was Fixed in This Session (2026-02-23)

### PDF Generation ‚Äî added from scratch

1. **pdfkit added** ‚Äî `npm install pdfkit` + `@types/pdfkit`; server-side PDF generation at
   `server/pdf.ts`. Two exported functions: `generateInvoicePDF` and `generatePriceListPDF`.
   Routes: `GET /api/orders/:id/pdf` (invoice) and `GET /api/customers/:id/pricelist` (price list).

2. **DejaVu Sans fonts** ‚Äî downloaded from jsDelivr (`dejavu-fonts-ttf@2.37.3`) and stored in
   `server/fonts/DejaVuSans.ttf` + `server/fonts/DejaVuSans-Bold.ttf` (~740 KB + ~690 KB).
   Supports full Cyrillic + Armenian block (U+0531‚ÄìU+058E). U+058F (÷è Armenian Dram) is NOT
   reliably present ‚Üí replaced with plain `AMD` text throughout.
   Font path: `path.join(process.cwd(), 'server', 'fonts', ...)` ‚Äî works in dev and Passenger.

3. **NaN crash fixed** ‚Äî `doc.widthOfString()` returns `NaN` for registered TTF fonts in pdfkit 0.15.
   Root cause: internal metrics differ from built-in fonts. Fix: removed all `widthOfString()` calls;
   used `{ align: 'center', width: ..., lineBreak: false }` instead of manual centering.

4. **Two-page invoice fixed** ‚Äî `drawFooter()` positioned text at Y‚âà797 (bottom‚Äì5); cursor advanced
   to Y‚âà807, crossing the 802 pt bottom margin ‚Üí pdfkit silently added blank page 2.
   Fix: removed `drawFooter()` call from `generateInvoicePDF` entirely (price list footer kept).

5. **Invoice layout** ‚Äî A4, CHIP Technologies green header (#277a3c), sections:
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ (order ‚Ññ, date, delivery date if set)
   - –ö–ª–∏–µ–Ω—Ç (–ö–æ–º–ø–∞–Ω–∏—è, –ò–ù–ù, Email, –¢–µ–ª–µ—Ñ–æ–Ω only)
   - –†–µ–∫–≤–∏–∑–∏—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è: ‘±’Å ’çal–±–∏–Ω–∞ –êleksany–∞n / ‘±’¥’•÷Ä’´’°’¢’°’∂’Ø ’ì‘≤‘∏ / —Å—á—ë—Ç 1570065472180100
   - –¢–æ–≤–∞—Ä—ã table (striped rows, –ò–¢–û–ì–û row)
   - `colX = { num:40, name:65, qty:340, price:395, total:470 }` ‚Äî headers at 8 pt to fit AMD labels

6. **Price list layout** ‚Äî multi-page, with `drawFooter()` per page, 6-column table filtered by
   `customer.customerType`; applies corporate/government markup from Settings.

7. **Customer PDF button gating** ‚Äî `OrderDetail.tsx` shows "–ù–∞–∫–ª–∞–¥–Ω–∞—è PDF" button disabled
   (with tooltip) until `deliveryStatus` is `confirmed | transit | delivered`. Admin always enabled.

8. **–ü–æ–ª—É—á–∞—Ç–µ–ª—å name** ‚Äî `–°alb–∏–Ω–∞` (Latin `b`) corrected to `–°al–±–∏–Ω–∞` (Cyrillic `–±`);
   the leading `’ç` was always Armenian Se (U+054D), not Cyrillic –° (U+0421).

## What Was Done in This Session (2026-02-23 session 3)

### Email / password recovery fixed

1. **Gmail credentials added to `~/.b2b_env`** ‚Äî `GMAIL_USER` and `GMAIL_APP_PASSWORD` were missing,
   causing all email sends to be silently skipped. Added App Password `rrdecgrvaycygake`.
   Regular Gmail password does NOT work ‚Äî must be a Gmail App Password (myaccount.google.com/apppasswords).

2. **Correct restart path discovered** ‚Äî App actually lives in `nodejs/`, not `public_html/`.
   `PassengerRestartDir` = `nodejs/tmp/`. All previous docs said `public_html/tmp/restart.txt` ‚Äî WRONG.
   Corrected everywhere in this file.

3. **UI/UX quick wins committed** (customer-facing):
   - Removed `maximum-scale=1` from viewport meta (pinch-zoom now works)
   - 404 page: Russian user-facing text + "–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥" button
   - Cart `+`/`‚àí` buttons: `h-6 w-6` ‚Üí `h-9 w-9` (better touch targets)
   - Home filter bar: `grid-cols-2` on mobile, `flex-wrap` on `sm+`; all SelectTriggers `w-full sm:w-40`

---

## What Was Done in This Session (2026-02-23 session 2)

### UI improvements + favicon

1. **Compact product table rows (admin mode)** ‚Äî `client/src/components/ProductListTable.tsx`
   - Previously the –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ column stacked 4 inputs vertically (Name ‚Üí SKU ‚Üí Brand ‚Üí Category),
     making each row ~4√ó taller than all other columns.
   - Fix: Name stays on its own line; SKU + Brand + Category are now a single `flex gap-1` row below it.
   - Each sub-field has `flex-1 min-w-0`; SelectTrigger gets `h-9` to match Input height.
   - Customer read-only branch and all other columns untouched.

2. **New favicon** ‚Äî `client/public/favicon.png` replaced with `attached_assets/chip_b2b_favicon.png`.
   `client/index.html` already had `<link rel="icon" type="image/png" href="/favicon.png" />` ‚Äî no change needed there.

3. **`server/pdf.ts` small manual edit** ‚Äî carried forward from user's direct GitHub edit (`34c88b5`).
   Pull-rebased and pushed cleanly on top (`24e6485`).

## What Was Done in This Session (2026-02-24)

### Admin "Add Product" form ‚Äî new fields
1. **–ê—Ä—Ç–∏–∫—É–ª (SKU) made required** ‚Äî `ProductForm.tsx`: `z.string().optional()` ‚Üí `z.string().min(1, "–í–≤–µ–¥–∏—Ç–µ –∞—Ä—Ç–∏–∫—É–ª")`. Label updated to `–ê—Ä—Ç–∏–∫—É–ª *`.
2. **–ë—Ä–µ–Ω–¥ field added** ‚Äî optional text input, placed beside –ê—Ä—Ç–∏–∫—É–ª in a 2-col grid. Passed to API on submit.
3. **–ú–û–ö field added** ‚Äî optional number input (minimum order quantity), placed below –¶–µ–Ω–∞/–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ row. Converted to `Number` on submit (undefined if empty).
   - Files: `client/src/components/ProductForm.tsx`

### Customer catalog ‚Äî –ë—Ä–µ–Ω–¥ column
4. **–ë—Ä–µ–Ω–¥ column** added to customer desktop table between –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ and –¶–µ–Ω–∞.
   - Customer grid template: `grid-cols-[1fr_100px_120px_120px_120px_80px_140px_100px]` (8 cols, was 7)
   - Mobile card: brand shown below SKU when present
   - Admin mode unchanged
   - File: `client/src/components/ProductListTable.tsx`

### Inquiry photo upload ‚Äî visual feedback
5. **Photo attachment indicator** on "–§–æ—Ç–æ" button in inquiry form (`Home.tsx` / `CustomerInquiriesSection`):
   - Before attachment: `ImagePlus` icon, default outline style
   - After attachment: `Check` icon, green border + green text (`border-green-500 text-green-700`)
   - Filename shown below button (truncated, max 120px) with √ó to remove the photo
   - Removed toast-on-upload (button state is the feedback)
   - File: `client/src/pages/Home.tsx`

### Price list PDF ‚Äî respects active filters
6. **Filtered PDF export** ‚Äî "–ü—Ä–∞–π—Å-–ª–∏—Å—Ç PDF" now only includes products visible after filters.
   - Added `useMemo filteredProductIds` computed from all filter state (search, price, status, eta, brand, category)
   - Button passes `?ids=id1,id2,...` when filters reduce the set; no param = full catalogue
   - Server `GET /api/price-list/pdf` accepts `?ids=` and filters `products` array before PDF generation
   - ‚ö†Ô∏è **PITFALL**: `useMemo` must be declared AFTER `const { data: products } = useQuery(...)` ‚Äî see bug below
   - Files: `client/src/pages/Home.tsx`, `server/routes.ts`

### üêõ Blank page bug ‚Äî `useMemo` before `products` declaration
7. **Root cause**: `filteredProductIds` useMemo was placed at line ~416 but `const { data: products }` was declared at line ~491. JavaScript `const` has a temporal dead zone ‚Äî the memo callback ran during first render and threw `ReferenceError: Cannot access 'products' before initialization` ‚Üí blank white page.
   - **Fix**: moved `useMemo` to immediately after the `products` `useQuery` declaration (commit `b7141ca`).
   - **Rule for future**: any hook/memo that references a `const` from another hook must come AFTER that hook's declaration line.

## What Was Done in This Session (2026-02-28)

### Category list finalised
The product category list was reviewed and locked to exactly 19 values used across the portal
AND in the Gemini AI prompt for category assignment. Any future category changes must be updated in:
1. `client/src/components/ProductListTable.tsx` ‚Äî `CATEGORIES` constant (admin edit dropdown)
2. `client/src/pages/Home.tsx` ‚Äî `categories` array in `CustomerInquiriesSection` (inquiry form)
3. `scripts/config.py` ‚Äî `CATEGORIES` list (Gemini system prompt)

Final 19 categories (must match portal exactly, including Cyrillic):
```
–ù–æ—É—Ç–±—É–∫–∏, –ö–æ–º–ø—å—é—Ç–µ—Ä—ã, –°–µ—Ä–≤–µ—Ä—ã, –¢–µ–ª–µ—Ñ–æ–Ω—ã, –ü–ª–∞–Ω—à–µ—Ç—ã,
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ü–ö/–°–µ—Ä–≤–µ—Ä–æ–≤, –ú–æ–Ω–∏—Ç–æ—Ä—ã, –ü—Ä–∏–Ω—Ç–µ—Ä—ã/–°–∫–∞–Ω–µ—Ä—ã,
–ü—Ä–æ–µ–∫—Ç–æ—Ä—ã –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏, –ò–ë–ü (UPS), –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã,
–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–°–•–î), –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ, –°–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ,
–ö–∞–±–µ–ª–∏/–ü–µ—Ä–µ—Ö–æ–¥–Ω–∏–∫–∏, –°–º–∞—Ä—Ç-–ì–∞–¥–∂–µ—Ç—ã, –¢–í/–ê—É–¥–∏–æ/–§–æ—Ç–æ/–í–∏–¥–µ–æ —Ç–µ—Ö–Ω–∏–∫–∞,
–¢–æ—Ä–≥–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, –°–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

### CSV conversion pipeline built (`scripts/`)
Python pipeline converts raw multi-supplier product export ‚Üí b2b.chip.am import format.
Scripts live in the repo (`S:\B2BPortal-main\scripts\`) but are **not** deployed to server ‚Äî run locally.

**How to run:**
```bash
pip install -r scripts/requirements.txt
python scripts/preprocess.py           # Step 1: ‚Üí intermediate.csv + parse_errors.csv
python scripts/ai_transform.py --test  # Step 2 (test, first 10 rows): ‚Üí output_import_test.csv
python scripts/ai_transform.py         # Step 2 (full run): ‚Üí output_import.csv
```

**Files:**
- `scripts/suppliers.csv` ‚Äî editable supplier registry (add new suppliers here, no code changes needed)
- `scripts/config.py` ‚Äî all tunable rates + Gemini API key + CB rate URL + file paths
- `scripts/preprocess.py` ‚Äî Step 1: parse raw CSV with misalignment recovery, filter/map fields
- `scripts/ai_transform.py` ‚Äî Step 2: fetch live CB rate, Gemini name/SKU/category, compute AMD price
- `scripts/requirements.txt` ‚Äî `google-generativeai>=0.7.0`, `requests>=2.31.0`

**Raw CSV format** (`raw_product_export_data.csv`):
```
Date, Source, Supplier, Category, Brand, Model, Name, Price, Currency, Stock, MOQ, Notes
```
‚ö†Ô∏è DG and Compstyle LLC rows have unescaped commas in the Name field ‚Äî `preprocess.py` handles
this with anchor detection (scans right-to-left for known Currency value "USD"/"AMD").

**Suppliers (3 currently; will grow to 20+):**
| Supplier | Type | Currency | ETA | Visibility |
|---|---|---|---|---|
| Proks SIA | international | USD | 14-21 –¥–Ω–µ–π | all 3 customer types |
| DG | local | USD | 1-2 –¥–Ω—è | –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π + –≥–æ—Å. —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ |
| Compstyle LLC | local | AMD | 1-2 –¥–Ω—è | –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π + –≥–æ—Å. —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ |

**Price formulas (in `config.py` ‚Äî ‚ö†Ô∏è review margins before running):**
```
international: price_usd √ó (1+SHIPPING 0.07) √ó (1+VAT 0.20) √ó (1+CUSTOMS 0.05) √ó cb_rate √ó (1+MARGIN 0.20)
local USD:     price_usd √ó cb_rate √ó (1+MARGIN 0.15)
local AMD:     price_amd √ó (1+MARGIN 0.15)
cb_rate:       fetched live from https://cb.am/latest.json.php ‚Üí float(data["USD"]) AMD per 1 USD
```

**Gemini API:** `gemini-2.5-flash-lite` via `google-generativeai` SDK
- Key in `config.py` (`GEMINI_API_KEY`)
- 50 products per batch call; 3-retry with backoff; fallback on failure
- Returns `name` (clean English ‚â§80 chars), `sku` (cleaned part number), `category` (from 19-item list)

**Stock mapping:**
- Local suppliers ‚Üí always `in_stock`
- International (Proks SIA): Stock 1‚Äì9 ‚Üí `low_stock`; Stock ‚â• 10 ‚Üí `in_stock`
- Zero-stock products excluded entirely from output

**‚ö†Ô∏è TODO before first run:** Adjust margin rates in `scripts/config.py`:
`INTL_SHIPPING_RATE`, `INTL_CUSTOMS_RATE`, `INTL_MARGIN`, `LOCAL_USD_MARGIN`, `LOCAL_AMD_MARGIN`

---

## How to Restart the App
```bash
# ‚ö†Ô∏è App root is nodejs/ ‚Äî NOT public_html/
# public_html/ only has .htaccess + empty tmp/ (it's the LiteSpeed web entry, not the Node app)
touch ~/domains/b2b.chip.am/nodejs/tmp/restart.txt
```

## How to Check Logs
```bash
ssh -p 65002 u217740454@178.16.128.65
cat ~/domains/b2b.chip.am/nodejs/stderr.log
ps aux | grep lsnode | grep -v grep
```

## How to Run App Manually (for debugging)
```bash
ssh -p 65002 u217740454@178.16.128.65
cd ~/domains/b2b.chip.am/nodejs
/opt/alt/alt-nodejs20/root/bin/node app.cjs
```

## Fix Sequence After Every Auto-Deploy
hPanel startup file is now set to `app.cjs` ‚Äî auto-deploys should work without manual intervention.
If a deploy still produces 503, check:
```bash
ssh -p 65002 u217740454@178.16.128.65
# 1. Verify .htaccess is correct (lives in nodejs/, not public_html/)
grep PassengerStartupFile ~/domains/b2b.chip.am/nodejs/.htaccess
# 2. Verify credentials exist (including GMAIL vars)
cat ~/.b2b_env
# 3. Restart if needed (restart dir is nodejs/tmp/)
touch ~/domains/b2b.chip.am/nodejs/tmp/restart.txt
# 4. Check after ~10s
curl -s -o /dev/null -w "%{http_code}" https://b2b.chip.am/
```

## Manual Rebuild (if auto-deploy fails)
```bash
ssh -p 65002 u217740454@178.16.128.65
cd ~/domains/b2b.chip.am/nodejs
/opt/alt/alt-nodejs20/root/usr/bin/node ./node_modules/.bin/vite build
/opt/alt/alt-nodejs20/root/usr/bin/node ./node_modules/.bin/esbuild server/index.ts \
  --platform=node --target=node20 --packages=external --bundle --format=esm --outdir=dist
sed -i 's/PassengerStartupFile logger.js/PassengerStartupFile app.cjs/' .htaccess
touch tmp/restart.txt
```

---

## Key Insights About Hostinger's Node.js (lsnode.js)
- Uses `require()` to load startup file ‚Üí startup file MUST be CJS (`.cjs` extension)
- Patches `http`/`net` in parent process to intercept `listen()` calls
- Does NOT support subprocess spawning (child `listen()` not intercepted ‚Üí 503)
- Auto-deployment regenerates `.htaccess` from hPanel settings
- `nodejs/.env` is wiped on each deploy ‚Üí use `~/.b2b_env` for persistent credentials
- **App root is `nodejs/`** ‚Äî `public_html/` is only the LiteSpeed web entry point (.htaccess + empty tmp/)
- `HOME` env var seen by Passenger = `‚Ä¶/b2b.chip.am` (NOT `/home/u217740454`) ‚Äî but `app.cjs` uses `path.resolve(__dirname, '../../..')` so it still finds `~/.b2b_env` correctly
- Restart via: `touch ~/domains/b2b.chip.am/nodejs/tmp/restart.txt`
